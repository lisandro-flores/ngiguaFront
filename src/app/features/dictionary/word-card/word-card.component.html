<div (click)="onSelectCard()" role="button" tabindex="0" [attr.aria-label]="'Ver detalles de ' + word.term"
    (keydown.enter)="onKeyEnter()" (keydown.space)="$event.preventDefault(); onKeyEnter()" 
    class="bg-[#151e32] border border-[#2a3655] rounded-sm p-4 hover:border-blue-500/40 transition-all duration-200 shadow-lg group relative overflow-hidden flex flex-col justify-between h-full min-h-[140px] break-inside-avoid mb-6 cursor-pointer">

    <!-- Botón Reportar (visible en hover) -->
    <button 
        (click)="onReport($event)" 
        class="absolute top-1.5 right-1.5 opacity-0 group-hover:opacity-100 text-slate-500 hover:text-red-400 transition-all z-20 bg-[#151e32] rounded-full p-1"
        title="Reportar palabra"
    >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
        </svg>
    </button>

    <div class="flex flex-col gap-3">
        
        <!-- Cabecera: Palabra + Audio + Like -->
        <div class="flex items-start justify-between">
            <div class="flex items-center gap-2">
                <h2 class="text-lg font-bold text-white tracking-tight leading-tight break-words">
                    {{ word.term }}
                </h2>
                
                <!-- Botón Audio -->
                @if (word.audioUrl) {
                <button (click)="playAudio($event)" 
                    class="text-slate-500 hover:text-blue-400 transition-colors inline-flex focus:outline-none" 
                    title="Escuchar pronunciación">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>
                </button>
                }
            </div>

            <!-- Botón Favorito (Votos) -->
            <button (click)="onVote($event)" 
                class="focus:outline-none active:scale-95 text-slate-600 hover:text-pink-500 transition-colors flex items-center gap-1" 
                title="Me gusta">
                @if (word.votes && word.votes > 0) {
                    <span class="text-[10px] font-bold text-slate-500">{{ word.votes }}</span>
                }
                <svg xmlns="http://www.w3.org/2000/svg" 
                    [class.fill-current]="word.votes && word.votes > 0"
                    [class.text-pink-500]="word.votes && word.votes > 0"
                    class="h-4 w-4" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
            </button>
        </div>

        <!-- Definiciones Compactas -->
        <div class="flex flex-col gap-2">
             <!-- Badge Tipo (Sustantivo, verbo, etc.) -->
             @if (word.type) {
                <div class="flex items-center gap-1">
                    <div class="px-1.5 py-px rounded-[2px] border border-blue-500/20 bg-blue-500/5 text-blue-400 font-bold uppercase tracking-wide inline-flex items-center w-max">
                        <span class="text-[9px]">{{ word.type }}</span>
                    </div>
                </div>
             }

             <!-- Definiciones -->
             @if (word.definitions && word.definitions.length > 0) {
                <div class="flex flex-col gap-1">
                    @for (def of word.definitions.slice(0, truncateDefinitions); track $index) {
                        <p class="text-sm text-slate-300 leading-snug line-clamp-2" [title]="def">
                            {{ def }}
                        </p>
                    }
                    @if (word.definitions.length > truncateDefinitions) {
                        <p class="text-xs text-slate-500 italic mt-0.5">+ {{ word.definitions.length - truncateDefinitions }} más...</p>
                    }
                </div>
             }

             <!-- Ejemplos (solo 1 si existe) -->
             @if (word.examples && word.examples.length > 0) {
                 <p class="text-xs text-slate-500 italic mt-1 line-clamp-1 border-l-2 border-slate-700 pl-2">
                    "{{ word.examples[0] }}"
                 </p>
             }
        </div>

        <!-- Conjugaciones (Restored and Styled) -->
        @if (word.conjugations && word.conjugations.length > 0) {
            <div class="mt-3 pt-3 border-t border-slate-700/50">
                <span class="text-[10px] font-bold text-slate-500 uppercase tracking-wider block mb-1">Conjugaciones</span>
                <p class="text-xs text-slate-400 font-mono leading-relaxed break-words">
                    {{ word.conjugations.join(', ') }}
                </p>
            </div>
        }

    </div>
</div>