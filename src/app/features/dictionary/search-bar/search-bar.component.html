<div class="max-w-3xl mx-auto">
  <div class="relative group">
    <!-- Icon -->
    <div class="absolute inset-y-0 left-0 flex items-center pl-5 pointer-events-none z-10">
      <svg class="w-6 h-6 text-slate-400 group-hover:text-ngigua-500 transition-colors duration-300" fill="none"
        stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
    </div>

    <!-- Tonal Keyboard Toolbar -->
    <div
      class="absolute -top-10 left-0 flex items-center space-x-2 px-1 fade-in transition-opacity duration-300"
      [class.opacity-100]="isFocused" [class.opacity-0]="!isFocused">
      <button type="button" (click)="insertChar('ꞌ')"
        class="bg-white dark:bg-slate-700 text-slate-800 dark:text-gray-200 px-3 py-1 rounded-md shadow-sm border border-slate-200 dark:border-slate-600 text-sm font-bold hover:bg-ngigua-50 dark:hover:bg-slate-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ngigua-400 transform hover:-translate-y-0.5 transition-all">
        ꞌ
      </button>
      <button type="button" (click)="insertChar('̱')" title="Tono bajo (subrayado)"
        class="bg-white dark:bg-slate-700 text-slate-800 dark:text-gray-200 px-3 py-1 rounded-md shadow-sm border border-slate-200 dark:border-slate-600 text-sm font-bold hover:bg-ngigua-50 dark:hover:bg-slate-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ngigua-400 transform hover:-translate-y-0.5 transition-all">
        a̱
      </button>
      <button type="button" (click)="insertChar('chr')"
        class="bg-white dark:bg-slate-700 text-slate-800 dark:text-gray-200 px-3 py-1 rounded-md shadow-sm border border-slate-200 dark:border-slate-600 text-sm font-bold hover:bg-ngigua-50 dark:hover:bg-slate-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ngigua-400 transform hover:-translate-y-0.5 transition-all">
        chr
      </button>
      <button type="button" (click)="insertChar('x')"
        class="bg-white dark:bg-slate-700 text-slate-800 dark:text-gray-200 px-3 py-1 rounded-md shadow-sm border border-slate-200 dark:border-slate-600 text-sm font-bold hover:bg-ngigua-50 dark:hover:bg-slate-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ngigua-400 transform hover:-translate-y-0.5 transition-all">
        x
      </button>
    </div>

    <!-- Input -->
    <input #searchInput type="text" (input)="onInput($event)" (focus)="onFocus()" (blur)="onBlur()" inputmode="search" autocomplete="off" spellcheck="false"
      class="block w-full py-5 pl-14 pr-6 text-lg text-slate-900 bg-white/90 dark:bg-slate-800/90 backdrop-blur-md border border-slate-200 dark:border-slate-700 rounded-none shadow-xl focus:outline-none focus:ring-4 focus:ring-ngigua-500/30 focus:border-ngigua-500 dark:text-white dark:placeholder-slate-400 dark:focus:border-ngigua-400 dark:focus:ring-ngigua-400/30 transition-all duration-300 ease-in-out hover:shadow-2xl hover:border-ngigua-300"
      [placeholder]="mode === 'precise' ? 'Buscar término exacto en Ngigua...' : 'Escribe una palabra en Ngigua o Español...'"
      autofocus required aria-label="Buscar palabra en Ngigua" aria-describedby="search-help" />

    <!-- Loading spinner (screen readers see status) -->
    <div *ngIf="loading" role="status" aria-live="polite" class="absolute inset-y-0 right-0 flex items-center pr-4">
      <svg class="w-5 h-5 text-ngigua-500 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor"
        aria-hidden="true">
        <circle cx="12" cy="12" r="10" stroke-width="2" class="opacity-20"></circle>
        <path d="M22 12a10 10 0 00-10-10" stroke-width="2" class="opacity-100"></path>
      </svg>
      <span class="sr-only">Buscando...</span>
    </div>

    <!-- Optional: Loader or Clear button icon could go here on the right -->
  </div>

  <!-- Search mode switch -->
  <div class="flex items-center justify-end mt-3">
    <label class="inline-flex items-center space-x-2 text-sm text-slate-600 dark:text-slate-400 cursor-pointer"
      title="Preciso: busca término exacto. Sugerencias: busca en términos y definiciones con relevancia.">
      <input type="checkbox" (change)="onToggleMode($event)" [checked]="mode === 'precise'" class="w-5 h-5 rounded" />
      <span class="select-none">Búsqueda precisa</span>
    </label>
  </div>

  <p id="search-help" class="sr-only">
    Usa el selector de búsqueda precisa para limitar resultados por término exacto.
  </p>
</div>